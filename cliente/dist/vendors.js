app.service("funcionService",function(){this.DigitoVerificacion=function(o){var e=[];e[0]=71,e[1]=67,e[2]=59,e[3]=53,e[4]=47,e[5]=43,e[6]=41,e[7]=37,e[8]=29,e[9]=23,e[10]=19,e[11]=17,e[12]=13,e[13]=7,e[14]=3;for(var r=15-o.length,t=0,i=0;i<o.length;i++)t+=o.substring(i,i+1)*e[r+i];var n=t%11;return n>=2&&(n=11-n),n},this.arrayObjectIndexOf=function(o,e,r){for(var t=0,i=o.length;t<i;t++)if(o[t][r]===e)return t;return-1},this.GetModuloUser=function(o){for(var e=["CONFIGURACION","CONTRATOS","PERSONAL","REPORTES","VEHICULOS","SERVICIOS"],r="",t=0,i=e.length;t<i;t++)r+=this.arrayObjectIndexOf(o,e[t],"pmModulo")!=-1?"1":"0";return r},this.FormaPago=function(){var o=["CREDITO","DEBITO","EFECTIVO","CHEQUE"];return o},this.FormatFecha=function(o,e){var r=new Date(o),t=3600*e;return r.setSeconds(t),r},this.PermisoCliente=function(){var o=[{IdPermiso:3},{IdPermiso:7},{IdPermiso:8}];return o}}),app.service("clienteService",["$http",function(o){this.get=function(e){var r=o.get(uri+"/api/cliente/"+e);return r},this.put=function(e,r){var t=o.put(uri+"/api/cliente/"+e,r);return t},this.updateEstado=function(e,r){var t=o.put(uri+"/api/cliente/updateEstado/"+e,r);return t},this.validarIdentificacion=function(e){var r=o.get(uri+"/api/cliente/"+e+"/validar");return r}}]),app.service("contratoService",["$http",function(o){this.get=function(e){var r=o.get(uri+"/api/contrato/"+e);return r},this.getPorNumeroCto=function(e){var r=o.get(uri+"/api/contrato/"+e+"/tiposervicio");return r},this.getByCliente=function(e,r){var t=o.get(uri+"/api/cliente/"+e+"/contratos/"+r);return t},this.getTipoVehiculo=function(e){var r=o.get(uri+"/api/plantilla/"+e+"/tipovehiculo");return r},this.getTransfert=function(e,r,t,i){var n=o.get(uri+"/api/transfert/"+e+"/"+r+"/"+t+"/"+i);return n}}]),app.service("parametroService",["$http",function(o){this.getAll=function(){var e=o.get(uri+"/api/parametro");return e}}]),app.service("servicioService",["$http",function(o){this.post=function(e){var r=o.post(uri+"/api/servicio",e);return r},this.getAll=function(e,r,t){var i=o.get(uri+"/api/cliente/"+e+"/servicios/"+r+"/"+t);return i}}]),app.service("usuarioService",["$http",function(o){this.get=function(e){var r=o.get(uri+"/api/usuario/"+e);return r},this.post=function(e){var r=o.post(uri+"/api/usuario",e);return r},this.put=function(e,r){var t=o.put(uri+"/api/usuario/"+e,r);return t},this.getUsers=function(e){var r=o.get(uri+"/api/cliente/"+e+"/usuarios");return r},this.getPermisos=function(e){var r=o.get(uri+"/api/usuario/"+e+"/permisos");return r},this.udpatePass=function(e){var r=o.post(uri+"/api/usuario/cambiar",e);return r},this.cerrarSesion=function(e){var r=o.delete(uri+"/api/usuario/"+e+"/cerrar");return r},this.validar=function(e){var r=o.get(uri+"/api/usuario/"+e+"/validar");return r}}]),app.service("zonaService",["$http",function(o){this.get=function(e){var r=o.get(uri+"/api/zona/"+e);return r},this.getPuntos=function(e){var r=o.get(uri+"/api/zona/"+e+"/puntos");return r},this.getZona=function(e,r){var t=o.get(uri+"/api/zona/"+e+"/"+r);return t}}]),app.controller("contratoController",["$scope","toaster","contratoService","ngTableParams",function(o,e,r,t){function i(){var t=r.getByCliente(o.$parent.Login.ClienteId,"Todos");t.then(function(e){o.Contatos=e.data,o.TablaContrato.reload()},function(o){e.pop("error","¡Error!","Error al cargar contratos"),console.log("Some Error Occured "+JSON.stringify(o))})}function n(){o.TablaContrato=new t({page:1,count:20,sorting:void 0},{filterDelay:50,total:1e3,counts:[],getData:function(e,r){var t=r.filter().busqueda;f=[],t?(t=t.toLowerCase(),f=o.Contatos.filter(function(o){return o.ctNitCliente.indexOf(t)>-1||o.ctContratante.toLowerCase().indexOf(t)>-1||o.ctNumeroContrato.indexOf(t)>-1||o.ctEstado.toLowerCase().indexOf(t)>-1})):f=o.Contatos,f=r.sorting()?f:f,r.total(f.length),e.resolve(f.slice((r.page()-1)*r.count(),r.page()*r.count()))}})}o.Contrato={},o.Contatos=[],o.TablaContrato={},o.VerDetalle=!1,o.$parent.SetTitulo("MIS CONTRATOS"),i(),n(),o.ConvertirFecha=function(o){var e=new Date(o);return e.toLocaleDateString("en-GB")},o.OcultarDetalle=function(){$("#dvDetalle").hide()},o.Get=function(t){o.VerDetalle=!0,o.Contrato.ctNumeroContrato=t,e.pop("wait","Consulta","Consultando informacioón....",0);var i=r.getPorNumeroCto(t);i.then(function(r){r.data?($("#dvDetalle").show(),e.clear(),o.Contrato=r.data,o.Contrato.FormaPago=JSON.parse(o.Contrato.ctFormaPago)):e.pop("error","Número de contrato no existe")},function(o){e.pop("error","¡Error!",o,0),console.log("Some Error Occured "+JSON.stringify(o))})}}]),app.controller("historialController",["$scope","toaster","servicioService","ngTableParams",function(o,e,r,t){function i(){o.TablaServicio=new t({page:1,count:20,sorting:void 0},{filterDelay:50,total:1e3,counts:[],getData:function(e,r){var t=r.filter().busqueda;f=[],t?(t=t.toLowerCase(),f=o.Servicios.filter(function(o){return o.ctNitCliente.indexOf(t)>-1||o.ctContratante.toLowerCase().indexOf(t)>-1||o.ctNumeroContrato.indexOf(t)>-1||o.ctEstado.toLowerCase().indexOf(t)>-1})):f=o.Servicios,f=r.sorting()?f:f,r.total(f.length),e.resolve(f.slice((r.page()-1)*r.count(),r.page()*r.count()))}})}o.Servicios=[],o.TablaServicio={},o.VerDetalle=!1,o.$parent.SetTitulo("HISTORIAL DE SERVICIOS"),i(),o.ConvertirFecha=function(o){var e=new Date(o);return e.toLocaleDateString("en-GB")},o.OcultarDetalle=function(){$("#dvDetalle").hide()},o.Get=function(r){o.VerDetalle=!0,o.Contrato.ctNumeroContrato=r,e.pop("wait","Consulta","Consultando informacioón....",0);var t=contratoService.getPorNumeroCto(r);t.then(function(r){r.data?(e.clear(),o.Contrato=r.data,o.Contrato.FormaPago=JSON.parse(o.Contrato.ctFormaPago),console.log(o.Contrato.FormaPago)):e.pop("error","Número de contrato no existe")},function(o){e.pop("error","¡Error!",o,0),console.log("Some Error Occured "+JSON.stringify(o))})},o.GetServicios=function(){var t=r.getAll(o.$parent.Login.ClienteId,o.$parent.Login.TipoAcceso,o.$parent.Login.Login);t.then(function(e){o.Servicios=e.data,o.TablaServicio.reload()},function(o){e.pop("error","¡Error!","Error al cargar Clientes"),console.log("Some Error Occured "+JSON.stringify(o))})},o.GetServicios()}]),app.controller("homeController",["$scope","parametroService",function(o,e){function r(){o.Login=session.getUser()}function t(){o.Login&&("SI"===o.Login.ValidarClave?location.href="#/2/usuario/clave":location.href="#/1/servicio")}o.Titulo="BIENVENIDOS",o.Login={},o.Configuracion={};var i=1;o.getConfiguracion=function(){var r=e.getAll();r.then(function(e){o.Configuracion=e.data,config.setConfig(btoa(JSON.stringify(e.data))),t()},function(o){console.log("failure loading usuarios",o)})},o.getConfiguracion(),o.mostrarOcultarMenu=function(){if(1===i){document.getElementById("cont-menu").className="menuLeft";var o=document.getElementById("contenido");o.classList.remove("contenido-normal"),o.classList.add("contenido-expandido"),i+=1}else{var o=document.getElementById("contenido");o.classList.remove("contenido-expandido"),o.classList.add("contenido-normal"),document.getElementById("cont-menu").className="menuRight",i=1}},o.SetTitulo=function(e){o.Titulo=e},r()}]),app.controller("salirController",["$scope","usuarioService","toaster",function(o,e,r){function t(){var t=e.cerrarSesion(o.$parent.Login.IdUsuario);t.then(function(e){sessionStorage.setItem("usuario",""),sessionStorage.removeItem("usuario"),o.mensaje="Su sesión ha finalizado correctamente",r.pop("success","¡Información!","Su sesión ha terminado."),setTimeout('location.href = "../inicio/index.html#/login"',3e3)},function(o){r.pop("error","¡Error!",o.data.request),console.log("failure loading usuarios",o)})}o.$parent.SetTitulo("CERRANDO SESIÓN"),o.mensaje="Cerrando sesión ....",t()}]),app.controller("serviciosController",["$scope","zonaService","ngTableParams","toaster","contratoService","funcionService","servicioService",function(o,e,r,t,i,n,a){function s(){this.coordenadas=null,this.marcador=null}function c(){o.Contrato={TipoServicio:[],Plantilla:[],TipoVehiculo:[],FechaInicio:"",FechaFin:"",Estado:"",Nombre:"",FormaPago:[]},o.Servicio={DireccionOrigen:"",DireccionDestino:"",ContratoId:0,NumeroContrato:"",Nit:"",Telefono:"",Tipo:{},Responsable:"",FechaServicio:moment().format("L"),Hora:"",Valor:0,NumHoras:"0",NumPasajeros:"0",ClienteId:o.$parent.Login.ClienteId,ZonaOrigen:"",ZonaDestino:"",LatOrigen:"",LngOrigen:"",LatDestino:"",LngDestino:"",UserReg:o.$parent.Login.Login,FormaPago:"",EnviarEmail:o.$parent.Configuracion.parEnviarEmail,ParEmail:o.$parent.Configuracion.parEmail}}function l(){var e=document.getElementById("txtOrigen");o.AutocompleteOrigen=new google.maps.places.Autocomplete(e,O),o.AutocompleteOrigen.bindTo("bounds",o.mapServicio),o.AutocompleteOrigen.addListener("place_changed",function(){h.close(),o.markerOrigen.setVisible(!1);var e=o.AutocompleteOrigen.getPlace();if(!e.geometry)return void t.pop("error","¡Error!","No pudo resolver la  posición");f(o.mapServicio,e),o.markerOrigen.setIcon("images/origen.png"),o.markerOrigen.setPosition(e.geometry.location),o.markerOrigen.setVisible(!0),o.popup||(o.popup=new google.maps.InfoWindow),o.Servicio.LatOrigen=e.geometry.location.lat(),o.Servicio.LngOrigen=e.geometry.location.lng(),v(o.Servicio.LatOrigen,o.Servicio.LngOrigen,"ZonaOrigen"),o.Servicio.DireccionOrigen=e.formatted_address;var r="";e.address_components&&(r=[e.address_components[0]&&e.address_components[0].short_name||"",e.address_components[1]&&e.address_components[1].short_name||"",e.address_components[2]&&e.address_components[2].short_name||""].join(" ")),h.setContent("<div><strong>"+e.name+"</strong><br>"+r),h.open(o.mapServicio,o.markerOrigen),E=e.place_id,g(E,P,L,N,T)})}function u(){var e=document.getElementById("txtDestino");o.AutocompleteDestino=new google.maps.places.Autocomplete(e,O),o.AutocompleteDestino.bindTo("bounds",o.mapServicio),o.AutocompleteDestino.addListener("place_changed",function(){h.close(),I.setVisible(!1);var e=o.AutocompleteDestino.getPlace();if(!e.geometry)return void t.pop("error","¡Error!","No pudo resolver la  posición");f(o.mapServicio,e),I.setIcon("images/destino.png"),I.setPosition(e.geometry.location),I.setVisible(!0),o.popup||(o.popup=new google.maps.InfoWindow),o.Servicio.LatDestino=e.geometry.location.lat(),o.Servicio.LngDestino=e.geometry.location.lng(),v(o.Servicio.LatDestino,o.Servicio.LngDestino,"ZonaDestino"),o.Servicio.DireccionDestino=e.formatted_address;var r="";e.address_components&&(r=[e.address_components[0]&&e.address_components[0].short_name||"",e.address_components[1]&&e.address_components[1].short_name||"",e.address_components[2]&&e.address_components[2].short_name||""].join(" ")),h.setContent("<div><strong>"+e.name+"</strong><br>"+r),h.open(o.mapServicio,I),P=e.place_id,g(E,P,L,N,T)})}function p(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){var r={lat:e.coords.latitude,lng:e.coords.longitude};o.Posicion.Latitud=e.coords.latitude,o.Posicion.Longitud=e.coords.longitude;var t=new google.maps.Circle({center:r,radius:e.coords.accuracy});o.AutocompleteOrigen.setBounds(t.getBounds())})}function d(){var e={zoom:16,center:new google.maps.LatLng(o.Posicion.Latitud,o.Posicion.Longitud),mapTypeId:google.maps.MapTypeId.ROADMAP};o.mapServicio=new google.maps.Map(document.getElementById("dvMapaServicio"),e),T.setMap(o.mapServicio),google.maps.event.addListener(o.mapServicio,"click",function(e){var r=e.latLng.lat(),t=e.latLng.lng(),i=new google.maps.LatLng(r,t),n=new google.maps.Marker({position:i,map:o.mapServicio,animation:google.maps.Animation.DROP,title:"Marcador"}),a=new s;a.coordenadas=i,a.marcador=n,o.vecPoligono.push(a),S()}),o.markerOrigen=new google.maps.Marker({map:o.mapServicio}),I=new google.maps.Marker({map:o.mapServicio})}function g(o,e,r,i,n){o&&e&&i.route({origin:{placeId:o},destination:{placeId:e},travelMode:r},function(o,e){e===google.maps.DirectionsStatus.OK?n.setDirections(o):t.pop("error","¡Error!","Error al resolver dirección")})}function f(o,e){e.geometry.viewport?o.fitBounds(e.geometry.viewport):(o.setCenter(e.geometry.location),o.setZoom(17))}function v(r,i,n){var a=e.getZona(r,i);a.then(function(e){return 0===e.data?(o.Servicio[n]="",void t.pop("error","No se encontro la zona")):void(o.Servicio[n]=e.data)},function(o){t.pop("error","¡Error!","Error al buscar zona ",0),console.log("Some Error Occured "+JSON.stringify(o))})}function m(){if(!o.TipoSelect.tvCodigo)return void t.pop("info","¡Alerta!","Seleccione el tipo de vehículo");if(""===o.Servicio.ZonaOrigen)return void t.pop("info","¡Alerta!","Por favor ingrese la dirección de origen correctamente");if(""===o.Servicio.ZonaDestino)return void t.pop("info","¡Alerta!","Por favor ingrese la dirección de destino correctamente");o.Servicio.Valor=0;var e=i.getTransfert(o.Plantilla.plCodigo,o.TipoSelect.tvCodigo,o.Servicio.ZonaOrigen,o.Servicio.ZonaDestino);e.then(function(e){e.data?(o.Servicio.Valor=e.data.tfValor,o.Servicio.Codigo=e.data.tfCodigo):t.pop("info","¡Alerta!","Estimado Usuario(a), no se encontró el precio con estos parametros de ubicación y tipo de vehículo",0)},function(o){t.pop("error","¡Error!","Error al buscar precios ",0),console.log("Some Error Occured "+JSON.stringify(o))})}function S(){for(var e=[],r=0;r<o.vecPoligono.length;r++)e.push(o.vecPoligono[r].coordenadas);null!==o.poly&&o.poly.setMap(null),o.poly=new google.maps.Polygon({paths:e,strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.25}),o.poly.setMap(o.mapServicio)}function C(e){var r=i.getTipoVehiculo(e);r.then(function(e){o.Contrato.TipoVehiculo=e.data,e.data&&(o.TipoSelect=e.data[0])},function(o){t.pop("error","¡Error!","Error al cargar tipos de vehículo",0),console.log("Some Error Occured "+JSON.stringify(o))})}o.Zonas=[],o.Zona={},o.Contrato={},o.Contratos=[],o.ContratoSelect={},o.Boton={Cargando:!0},o.$parent.SetTitulo("SOLICITAR SERVICIOS"),o.Servicio={},o.TipoSelect={},o.Plantilla={},o.Puntos=[],o.editMode=!1,o.mapServicio,o.markerOrigen=null;var I=null,h=new google.maps.InfoWindow,O={componentRestrictions:{country:"co"}},E=null,P=null,L=google.maps.TravelMode.DRIVING,N=new google.maps.DirectionsService,T=new google.maps.DirectionsRenderer;o.vecPoligono=new Array,o.poly=null,o.tbZona={},o.title="Nuevo Servicio",o.Posicion={Latitud:10.4370725,Longitud:-75.524795},o.$parent.SetTitulo("GESTIÓN DE SERVICIOS"),o.AutocompleteOrigen=null,o.AutocompleteDestino=null,p(),d(),l(),u(),c(),o.eliminarUltimoPunto=function(){o.vecPoligono.length>0&&(o.vecPoligono[o.vecPoligono.length-1].marcador.setMap(null),o.vecPoligono.pop(),S())},o.CambiarFormato=function(e){o.Servicio[e]=n.FormatFecha(o.Servicio[e],5),o.Servicio[e]=moment(o.Servicio[e]).format("L")},o.Nuevo=function(){o.editMode=!1,o.title="Nuevo Servicio",c()},o.get=function(e){o.editMode=!0,o.title="EDITAR ZONA",o.Zona=e,getPuntos(e.znCodigo)},o.BuscarContrato=function(e){o.Servicio.ContratoId=0;var r="";if("COMBO"===e)r=o.ContratoSelect.ctNumeroContrato;else{if(!o.Servicio.NumeroContrato)return void t.pop("info","Estimado usuario(a), por favor ingrese el número de contrato");r=o.Servicio.NumeroContrato}t.pop("wait","Consulta","Consultando informacioón....",0),o.Servicio.Tipo=[];var n=i.getPorNumeroCto(r);n.then(function(e){e.data?(t.clear(),o.Servicio.ContratoId=e.data.IdContrato,o.Contrato.Nombre=e.data.ctContratante,o.Servicio.Nit=e.data.ctNitCliente,o.Servicio.Telefono=e.data.ctTelefono,o.Servicio.NumeroContrato=o.ContratoSelect.ctNumeroContrato,o.Contrato.FormaPago=angular.copy(JSON.parse(e.data.ctFormaPago)),o.Contrato.FechaFin=new Date(e.data.ctFechaFinal).toLocaleDateString("en-GB"),o.Contrato.FechaInicio=new Date(e.data.ctFechaInicio).toLocaleDateString("en-GB"),o.Contrato.Estado=e.data.ctEstado,o.Contrato.TipoServicio=e.data.TipoServicio,o.Contrato.Plantilla=e.data.Plantilla,0===o.Contrato.TipoServicio&&t.pop("error","No se encontraón servicios asociados a este contrato",0)):t.pop("error","Número de contrato no existe")},function(o){t.pop("error","¡Error!",o,0),console.log("Some Error Occured "+JSON.stringify(o))})},o.TipoServicioCheck=function(e){if("SI"===o.Servicio.Tipo.csPlantilla){if(1===o.Servicio.Tipo.csTipoServicioId&&(document.getElementById("dvMapaServicio").style.display="block",p(),d(),l(),u()),o.titlePlantilla="Plantillas "+o.Servicio.Tipo.csDescripcion,0===o.Contrato.Plantilla.length)return void t.pop("error","¡Error!","No se definieron plantillas para este contrato");var r=n.arrayObjectIndexOf(o.Contrato.Plantilla,o.Servicio.Tipo.csTipoServicioId,"pcTipoServicio");r>=0&&(o.Plantilla=o.Contrato.Plantilla[r],C(o.Plantilla.plCodigo))}else o.titlePlantilla="Dispobilidad ",o.VerPlantilla=!1},o.ConsultarPrecio=function(){var e=parseInt(o.Servicio.Tipo.csTipoServicioId);switch(e){case 1:m();break;case 2:break;case 3:break;case 4:break;default:t.pop("error","¡Alerta!","Seleccione un tipo de servicio")}},o.GetContratos=function(){c();var e=i.getByCliente(o.Servicio.ClienteId,"ACTIVO");e.then(function(e){o.Contratos=e.data,o.ContratoSelect={}},function(o){t.pop("error","¡Error!","Error al cargar contratos"),console.log("Some Error Occured "+JSON.stringify(o))})},o.Guardar=function(){if(!o.Servicio.Tipo.csTipoServicioId)return void t.pop("info","¡Alerta!","Seleccione el tipo de servicio");if(!o.TipoSelect.tvCodigo)return void t.pop("info","¡Alerta!","Seleccione el tipo de vehículo");if(o.Servicio.NumPasajeros>o.TipoSelect.tvNumPasajero)return void t.pop("info","¡Alerta!","Estimado Usuario(a), el número de pasajeros supera el limite permitido para el tipo de vehículo seleccionado ("+o.TipoSelect.tvDescripcion+")",7e3);if(0===o.Servicio.Valor)return void t.pop("info","¡Alerta!","Valor del servicio no puede ser cero(0). Por favor hacer click en consultar precio");if(""===o.Servicio.FormaPago)return void t.pop("info","¡Alerta!","Estimado Usuario(a), por favor seleccione la forma de Pago");o.Servicio.TipoVehiculoId=o.TipoSelect.tvCodigo,o.Servicio.DescVehiculo=o.TipoSelect.tvDescripcion,o.Servicio.NumeroContrato=o.ContratoSelect.ctNumeroContrato,o.Servicio.TipoServicidoId=o.Servicio.Tipo.csTipoServicioId,o.Servicio.PlantillaId=o.Plantilla.plCodigo;var e=a.post(o.Servicio);e.then(function(e){t.pop("success","¡Información!",e.data.message),o.ContratoSelect={},o.Nuevo()},function(o){t.pop("error","¡Error!",o.data.request),console.log("Some Error Occured "+JSON.stringify(o))})},o.GetContratos()}]),app.controller("usuarioController",["$scope","usuarioService","toaster","ngTableParams","funcionService","clienteService","contratoService",function(o,e,r,t,i,n,a){function s(){o.Usuario={IdUsuario:"",Login:"",Nombre:"",Estado:"ACTIVO",Modulo:"",Sesion:"CERRADA",DirIp:"",ClienteId:o.$parent.Login.ClienteId,PersonaId:null,ConductorId:null,TipoAcceso:"5",ValidarClave:"SI",Email:"",Contrato:"",Permisos:[],Identificacion:""}}function c(){var t=e.getUsers(o.$parent.Login.ClienteId);t.then(function(e){o.Usuarios=e.data,o.TablaUsuario.reload()},function(o){r.pop("error","¡Error!","Error al cargar usuarios"),console.log("failure loading usuarios",o)})}function l(t){o.Usuario.Permisos=[];var i=e.getPermisos(t);i.then(function(e){e.data.length&&(o.Usuario.Permisos=angular.copy(e.data))},function(o){r.pop("error","¡Error!","Error al cargar permisos del usuario seleccionado"),console.log("error al cargar permisos",o)})}function u(){o.TablaUsuario=new t({page:1,count:10,sorting:void 0},{filterDelay:50,total:1e3,counts:[],getData:function(e,r){var t=r.filter().busqueda;f=[],t?(t=t.toLowerCase(),f=o.Usuarios.filter(function(o){return o.IdUsuario.toLowerCase().indexOf(t)>-1||o.Nombre.toLowerCase().indexOf(t)>-1||o.Estado.toLowerCase().indexOf(t)>-1})):f=o.Usuarios,f=r.sorting()?f:f,r.total(f.length),e.resolve(f.slice((r.page()-1)*r.count(),r.page()*r.count()))}})}o.Usuario={},o.Usuarios=[],o.Perfiles=[],o.Permisos=[],o.title="Nuevo Usuario",o.editMode=!1,o.valPass=!1,o.ValLogin=!1,o.IdUsuarioGlobal="",o.TablaUsuario={},o.User={},o.ContratoSelect={},o.$parent.SetTitulo("GESTION DE USUARIOS"),c(),s(),u(),o.Nuevo=function(){s(),o.editMode=!1,o.title="Nuevo Usuario"},o.get=function(e){o.editMode=!0,o.title="Editar Usuario",o.Usuario=e,o.Usuario.TipoAcceso=e.TipoAcceso.toString(),l(e.IdUsuario),$('#tabPanels a[href="#tabRegistro"]').tab("show")},o.Guardar=function(){if(o.ValLogin)return void r.pop("error","¡Error!","Nombre de usuario ya existe");if("5"===o.Usuario.TipoAcceso&&!o.ContratoSelect)return void r.pop("info","¡Alerta!","El tipo de usuario es SUBCLIENTE, por favor indique el contrato.");o.Usuario.Contrato=o.ContratoSelect.ctNumeroContrato?o.ContratoSelect.ctNumeroContrato:0,o.Usuario.Modulo="01000",o.Usuario.Nombre=o.Usuario.Nombre.toUpperCase();var t;o.editMode?t=e.put(o.Usuario.IdUsuario,o.Usuario):(t=e.post(o.Usuario),o.Usuario.Permisos=i.PermisoCliente()),t.then(function(e){r.pop("success","Control de Información",e.data.message),o.Nuevo(),c(),$('#tabPanels a[href="#tabListado"]').tab("show")},function(o){r.pop("error","¡Error!",o.data.request),console.log("Some Error Occured "+JSON.stringify(o))})},o.BuscarIdentificacion=function(){if(!o.Usuario.Identificacion)return void r.pop("info","¡Alerta!","Por favor ingrese el número de identificación")},o.ValidarLogin=function(){if(o.ValLogin=!1,!o.editMode){if(!o.Usuario.Login)return void r.pop("info","¡Alerta!","Por favor ingrese el Login");var t=e.validar(o.Usuario.Login);t.then(function(e){e.data.Login&&(o.ValLogin=!0,r.pop("info","Nombre de usuario ya existe"))},function(o){r.pop("error","Error","Error al validar login"),console.log("Some Error Occured "+JSON.stringify(o))})}},o.CambiarPass=function(e,r,t){o.User={IdUsuario:e,Nombre:r,Login:t,Clave:"",claveConf:""},$('#tabPanels a[href="#tabCambiarC"]').tab("show")},o.cancelar=function(){o.valPass=!1,o.User={IdUsuario:"",Nombre:"",Login:"",Clave:"",claveConf:""},$('#tabPanels a[href="#tabListado"]').tab("show")},o.guardarPass=function(){if(o.valPass=!1,!o.User.IdUsuario)return void r.pop("info","¡Alerta!","Seleccione un usuario para realizar este procedimiento.");if(o.User.Clave!==o.User.claveConf)return o.valPass=!0,void r.pop("info","¡Alerta!","Contraseñas no coinciden.. verifique");var t={Id:o.User.IdUsuario,Clave:o.User.Clave},i=e.udpatePass(t);i.then(function(e){"Correcto"===e.data.message?(r.pop("success","¡Información!",e.data.request),o.cancelar()):r.pop("error","¡Error!",e.data.request)},function(o){r.pop("error","¡Error!",o.request,0),console.log("Some Error Occured "+JSON.stringify(o))})},o.VerDesactivar=function(e,r){o.Estado=r,o.IdUsuarioGlobal=e,$("#mdConfirmacion").modal("show")},o.Desactivar=function(){var t={Estado:o.Estado};$("#mdConfirmacion").modal("hide");var i=e.updateEstado(o.IdUsuarioGlobal,t);i.then(function(o){r.pop("success","Control de Información",o.data.message),c()},function(o){r.pop("error","Error","ERROR AL PROCESAR DESACTIVAR / ACTIVAR"),console.log("Some Error Occured "+JSON.stringify(o))})},o.GetContratos=function(){var e=a.getByCliente(o.Usuario.ClienteId,"ACTIVO");e.then(function(e){o.Contratos=e.data},function(o){r.pop("error","¡Error!","Error al cargar contratos"),console.log("Some Error Occured "+JSON.stringify(o))})},o.GetContratos(),u()}]),app.controller("cambiarClaveController",["$scope","usuarioService","toaster",function(o,e,r){function t(){o.User={IdUsuario:o.$parent.Login.IdUsuario,Nombre:o.$parent.Login.Nombre,Login:o.$parent.Login.Login,Clave:"",claveConf:""}}o.User={},t(),o.$parent.SetTitulo("CAMBIAR CONTRASEÑA"),o.cancelar=function(){t()},o.guardarPass=function(){if(o.valPass=!1,!o.User.IdUsuario)return void r.pop("info","¡Alerta!","Seleccione un usuario para realizar este procedimiento.");if(o.User.Clave!==o.User.claveConf)return o.valPass=!0,void r.pop("info","¡Alerta!","Contraseñas no coinciden.. verifique");var t={Id:o.User.IdUsuario,Clave:o.User.Clave},i=e.udpatePass(t);i.then(function(o){"Correcto"===o.data.message?(r.pop("success","¡Información!",o.data.request+"                 en segundos sera redireccionado al inicio de sesion, para que ingrese con sus nuevos datos.",0),sessionStorage.setItem("usuario",""),sessionStorage.removeItem("usuario"),setTimeout('location.href = "../inicio/index.html#/login"',5e3)):r.pop("error","¡Error!",o.data.request)},function(o){r.pop("error","¡Error!",o.request,0),console.log("Some Error Occured "+JSON.stringify(o))})}}]),app.controller("cambiarClaveController",["$scope","usuarioService","toaster",function(o,e,r){function t(){o.User={IdUsuario:o.$parent.Login.IdUsuario,Nombre:o.$parent.Login.Nombre,Login:o.$parent.Login.Login,Clave:"",claveConf:""}}o.User={},t(),o.cancelar=function(){t()},o.guardarPass=function(){if(o.valPass=!1,!o.User.IdUsuario)return void r.pop("info","¡Alerta!","Seleccione un usuario para realizar este procedimiento.");if(o.User.Clave!==o.User.claveConf)return o.valPass=!0,void r.pop("info","¡Alerta!","Contraseñas no coinciden.. verifique");var t={Id:o.User.IdUsuario,Clave:o.User.Clave},i=e.udpatePass(t);i.then(function(o){"Correcto"===o.data.message?(r.pop("success","¡Información!",o.data.request+"                 en segundos sera redireccionado al inicio de sesion, para que ingrese con sus nuevos datos.",0),sessionStorage.setItem("usuario",""),sessionStorage.removeItem("usuario"),setTimeout('location.href = "../inicio/index.html#/login"',5e3)):r.pop("error","¡Error!",o.data.request)},function(o){r.pop("error","¡Error!",o.request,0),console.log("Some Error Occured "+JSON.stringify(o))})}}]);var session={setUsuario:function(o){sessionStorage.setItem("usuario",o)},getUsuario:function(){return this.validarObjectLocal("usuario")?JSON.parse(sessionStorage.getItem("usuario")):null},validarObjectLocal:function(o){return""!==sessionStorage.getItem(o)&&void 0!==sessionStorage.getItem(o)&&null!==sessionStorage.getItem(o)},getUser:function(){var o=sessionStorage.getItem("usuario");return o?JSON.parse(atob(o)):(alert("Acceso Denegado, no tiene permisos para realizar esta operación"),location.href="../inicio/index.html#/login",null)}},config={setConfig:function(o){sessionStorage.setItem("trlconfig",o)},getConfig:function(){return this.validarObjectLocal("trlconfig")?JSON.parse(atob(sessionStorage.getItem("trlconfig"))):null},validarObjectLocal:function(o){return""!==sessionStorage.getItem(o)&&void 0!==sessionStorage.getItem(o)&&null!==sessionStorage.getItem(o)},getLatitud:function(){var o=sessionStorage.getItem("trlconfig");if(o)return o.parLatitud},getLongitud:function(){var o=sessionStorage.getItem("trlconfig");if(o)return o.parLongitud},getEmail:function(){var o=JSON.parse(sessionStorage.getItem("trlconfig"));if(o)return o.Email}};